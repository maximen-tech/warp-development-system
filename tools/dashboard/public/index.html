<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Warp Dashboard</title>
    <style>
      body { font-family: system-ui, sans-serif; margin: 0; padding: 0; background: #0b0f14; color: #e6edf3; }
      header { padding: 12px 16px; background: #151b23; border-bottom: 1px solid #263040; }
      .wrap { padding: 16px; }
      .event { padding: 8px 12px; background: #11161d; border: 1px solid #263040; border-radius: 8px; margin-bottom: 8px; }
      .ts { color: #9fb3c8; font-size: 12px; }
      .ok { color: #27d980; }
      .err { color: #ff6b6b; }
      .info { color: #6ab7ff; }
      .action { font-weight: 600; }
      .msg { opacity: .9; }
    </style>
  </head>
  <body>
    <header>
      <strong>Warp Dashboard</strong>
    </header>
    <div class="wrap" id="list"></div>
    <script>
      const list = document.getElementById('list');
      const source = new EventSource('/events');
      function render(ev) {
        const div = document.createElement('div');
        div.className = 'event';
        const statusClass = ev.status === 'ok' || ev.status === 'end' ? 'ok' : (ev.status === 'error' ? 'err' : 'info');
        div.innerHTML = `
          <div class="ts">${ev.ts || ''}</div>
          <div><span class="action">${ev.action}</span> Â· <span class="${statusClass}">${ev.status}</span></div>
          <div class="msg">${(ev.message||'').replace(/</g,'&lt;')}</div>
        `;
        list.prepend(div);
      }
      source.onmessage = (e) => {
        try { const ev = JSON.parse(e.data); render(ev); } catch {}
      };
      source.onerror = () => {
        const div = document.createElement('div');
        div.className = 'event';
        div.innerHTML = '<div class="msg err">Lost connection to server...</div>';
        list.prepend(div);
      };
    </script>
  </body>
</html>
