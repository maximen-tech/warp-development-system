<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Analytics & Insights - Warp Dashboard</title>
    <link rel="stylesheet" href="/styles.css" />
    <link rel="stylesheet" href="/analytics.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  </head>
  <body>
    <header>
      <a class="pill" href="/">‚Üê Dashboard</a>
      <strong>Analytics & Insights</strong>
      <select id="timeRange" class="pill">
        <option value="1h">Last Hour</option>
        <option value="24h" selected>Last 24 Hours</option>
        <option value="7d">Last 7 Days</option>
        <option value="30d">Last 30 Days</option>
        <option value="custom">Custom Range</option>
      </select>
      <button class="pill" onclick="refreshAnalytics()">üîÑ Refresh</button>
      <button class="pill" onclick="exportReport()">üìÑ Export Report</button>
    </header>
    
    <div class="wrap">
      <!-- KPI Cards -->
      <div class="kpi-grid">
        <div class="kpi-card">
          <div class="kpi-icon">üìä</div>
          <div class="kpi-content">
            <div class="kpi-label">Total Runs</div>
            <div class="kpi-value" id="kpiRuns">-</div>
            <div class="kpi-trend" id="kpiRunsTrend"></div>
          </div>
        </div>
        
        <div class="kpi-card">
          <div class="kpi-icon">‚úÖ</div>
          <div class="kpi-content">
            <div class="kpi-label">Success Rate</div>
            <div class="kpi-value" id="kpiSuccess">-</div>
            <div class="kpi-trend" id="kpiSuccessTrend"></div>
          </div>
        </div>
        
        <div class="kpi-card">
          <div class="kpi-icon">‚ö°</div>
          <div class="kpi-content">
            <div class="kpi-label">Avg Latency</div>
            <div class="kpi-value" id="kpiLatency">-</div>
            <div class="kpi-trend" id="kpiLatencyTrend"></div>
          </div>
        </div>
        
        <div class="kpi-card">
          <div class="kpi-icon">üí∞</div>
          <div class="kpi-content">
            <div class="kpi-label">Total Cost</div>
            <div class="kpi-value" id="kpiCost">-</div>
            <div class="kpi-trend" id="kpiCostTrend"></div>
          </div>
        </div>
        
        <div class="kpi-card">
          <div class="kpi-icon">ü§ñ</div>
          <div class="kpi-content">
            <div class="kpi-label">Active Agents</div>
            <div class="kpi-value" id="kpiAgents">-</div>
            <div class="kpi-trend" id="kpiAgentsTrend"></div>
          </div>
        </div>
        
        <div class="kpi-card">
          <div class="kpi-icon">‚ö†Ô∏è</div>
          <div class="kpi-content">
            <div class="kpi-label">Error Rate</div>
            <div class="kpi-value" id="kpiErrors">-</div>
            <div class="kpi-trend" id="kpiErrorsTrend"></div>
          </div>
        </div>
      </div>

      <!-- Charts Grid -->
      <div class="charts-grid">
        <div class="card">
          <h3>Success/Failure Trends</h3>
          <canvas id="trendsChart"></canvas>
        </div>
        
        <div class="card">
          <h3>Agent Usage Distribution</h3>
          <canvas id="agentChart"></canvas>
        </div>
        
        <div class="card">
          <h3>Cost Breakdown by Model</h3>
          <canvas id="costChart"></canvas>
        </div>
        
        <div class="card">
          <h3>Latency Distribution</h3>
          <canvas id="latencyChart"></canvas>
        </div>
      </div>

      <!-- Agent Performance Table -->
      <div class="card">
        <div class="row" style="justify-content: space-between; align-items: center; margin-bottom: 1rem;">
          <h3>Agent Performance</h3>
          <div class="row" style="gap: 8px;">
            <input id="agentSearch" class="pill" placeholder="üîç Search agents..." style="min-width: 200px;" />
            <select id="agentSort" class="pill" onchange="sortAgents(this.value)">
              <option value="runs">Most Runs</option>
              <option value="success">Best Success Rate</option>
              <option value="latency">Fastest</option>
              <option value="errors">Most Errors</option>
              <option value="cost">Highest Cost</option>
            </select>
          </div>
        </div>
        <div class="table-container">
          <table id="agentTable">
            <thead>
              <tr>
                <th>Agent</th>
                <th>Runs</th>
                <th>Success %</th>
                <th>Avg Latency</th>
                <th>Errors</th>
                <th>Cost</th>
                <th>Health</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="agentTableBody"></tbody>
          </table>
        </div>
      </div>

      <!-- Heatmap -->
      <div class="card">
        <h3>Activity Heatmap (24h)</h3>
        <div id="heatmapContainer"></div>
      </div>

      <!-- AI Insights -->
      <div class="card insights-card">
        <div class="row" style="justify-content: space-between; align-items: center; margin-bottom: 1rem;">
          <h3>üîÆ AI Insights & Recommendations</h3>
          <button class="pill" onclick="refreshInsights()">Generate Insights</button>
        </div>
        <div id="insightsContainer"></div>
      </div>

      <!-- Cost Tracking -->
      <div class="card">
        <h3>Cost Tracking & Budget</h3>
        <div class="cost-summary">
          <div class="cost-row">
            <span>Monthly Budget:</span>
            <span id="budgetTotal">$500.00</span>
          </div>
          <div class="cost-row">
            <span>Current Spend:</span>
            <span id="budgetSpend">-</span>
          </div>
          <div class="progress-bar">
            <div id="budgetProgress" class="progress-fill"></div>
          </div>
          <div class="cost-row small">
            <span>Remaining:</span>
            <span id="budgetRemaining">-</span>
          </div>
        </div>
        
        <h4 style="margin-top: 1.5rem;">Cost by Model</h4>
        <table class="cost-table">
          <thead>
            <tr>
              <th>Model</th>
              <th>Tokens</th>
              <th>Rate</th>
              <th>Cost</th>
              <th>% of Total</th>
            </tr>
          </thead>
          <tbody id="costTableBody"></tbody>
        </table>
        
        <div id="costRecommendations" class="recommendations"></div>
      </div>
    </div>

    <script src="/analytics.js"></script>
  </body>
</html>
